services:
  editor:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: editor
    ports:
      - "3008:80"
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    networks:
      - dokploy-network
    labels:
      # Labels Traefik pour Dokploy
      - "traefik.enable=true"
      - "traefik.docker.network=dokploy-network"
      
      # HTTP (Port 80) â†’ Redirect vers HTTPS
      - "traefik.http.routers.editor-http.entrypoints=frontendsecure"
      - "traefik.http.routers.editor-http.rule=Host(`portal.c-simweb.de`)"
      - "traefik.http.routers.editor-http.middlewares=editor-https-redirect"
      - "traefik.http.middlewares.editor-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.middlewares.editor-https-redirect.redirectscheme.permanent=true"
      
      # HTTPS Router
      - "traefik.http.routers.editor.entrypoints=frontendsecure"
      - "traefik.http.routers.editor.rule=Host(`portal.c-simweb.de`)"
      - "traefik.http.routers.editor.tls=true"
      - "traefik.http.routers.editor.tls.certresolver=letsencrypt"
      - "traefik.http.services.editor.loadbalancer.server.port=80"

networks:
  dokploy-network:
    external: true
